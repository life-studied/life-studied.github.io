<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>4-6 GDI通用模板+demo | Yunyin&#39;s blog</title>
  
    <link rel="icon" href="/assert/C++.jpg">
  
  
  
  <!--link rel="stylesheet" href="//cdn.jsdelivr.net/highlight.js/9.10.0/styles/github-gist.min.css"-->
  
<link rel="stylesheet" href="//cdn.jsdelivr.net/highlight.js/9.10.0/styles/github-gist.min.css">

  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 6.3.0"></head>

<body>
<div class="Shell">
    <aside class='SideBar'>
    <section class='avatar' style="background-image: url(/assets/background.jpg)">
        <div class='av-pic' style="background-image: url(/assets/C++.jpg)">
        </div>
    </section>
    <section class='menu'>
        <div>Yunyin&#39;s blog</div>
        
        <ul>
          
            <a href="/" class="Btn">
              <li>Home</li>
            </a>  
          
            <a href="/archives/" class="Btn">
              <li>Archive</li>
            </a>  
          
            <a href="/tags/" class="Btn">
              <li>Tags</li>
            </a>  
          
            <a href="/categories/" class="Btn">
              <li>Categories</li>
            </a>  
          
        </ul>
    </section>
    <section class="media">
        
    </section>
</aside>

    <div class="container">
        <div data-pager-shell>
            <div>
  <article class='ContentView'>
    <header class='PageTitle'>
        <h1>4-6 GDI通用模板+demo</h1>
    </header>

    <section>
      <h2 id="GDI通用模板-demo">GDI通用模板+demo</h2>
<h4 id="1-通用模板">1.通用模板</h4>
<span id="more"></span>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">程序名称：GDIdemoCore</span></span><br><span class="line"><span class="comment">描述：实现GDI游戏开发所需的核心程序</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;tchar.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WINDOW_WIDTH 800</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WINDOW_HEIGHT 600</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WINDOW_TITLE _T(<span class="string">&quot;【致我们永不熄灭的游戏开发梦想】GDI程序核心框架&quot;</span>)</span></span><br><span class="line"></span><br><span class="line">HDC g_hdc = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="function">LRESULT CALLBACK <span class="title">WndProc</span><span class="params">(HWND hwnd, UINT message, WPARAM wParam, LPARAM lParam)</span></span>;	<span class="comment">//窗口过程函数</span></span><br><span class="line"><span class="function">BOOL <span class="title">Game_Init</span><span class="params">(HWND hwnd)</span></span>;		<span class="comment">//资源初始化函数</span></span><br><span class="line"><span class="function">VOID <span class="title">Game_Paint</span><span class="params">(HWND hwnd)</span></span>;		<span class="comment">//绘图代码的集合</span></span><br><span class="line"><span class="function">BOOL <span class="title">Game_CleanUp</span><span class="params">(HWND hwnd)</span></span>;	<span class="comment">//资源清理函数</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> WINAPI <span class="title">WinMain</span><span class="params">(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpCmdLine, <span class="type">int</span> nShowCmd)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	WNDCLASSEX wndClass = &#123;</span><br><span class="line">	<span class="built_in">sizeof</span>(WNDCLASSEX),</span><br><span class="line">	CS_HREDRAW | CS_VREDRAW,</span><br><span class="line">	WndProc,</span><br><span class="line">	<span class="number">0L</span>,</span><br><span class="line">	<span class="number">0L</span>,</span><br><span class="line">	hInstance, (HICON)::<span class="built_in">LoadImage</span>(<span class="literal">NULL</span>,_T(<span class="string">&quot;icon.ico&quot;</span>),</span><br><span class="line">	IMAGE_ICON,<span class="number">0</span>,<span class="number">0</span>, LR_DEFAULTSIZE | LR_LOADFROMFILE),</span><br><span class="line">	<span class="built_in">LoadCursor</span>(<span class="literal">NULL</span>, IDC_ARROW),</span><br><span class="line">	(HBRUSH)<span class="built_in">GetStockObject</span>(GRAY_BRUSH),</span><br><span class="line">	<span class="literal">NULL</span>,</span><br><span class="line">	_T(<span class="string">&quot;EorTheDreamOfGameDevelop&quot;</span>),</span><br><span class="line">	<span class="literal">NULL</span></span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!<span class="built_in">RegisterClassEx</span>(&amp;wndClass)) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">	HWND hwnd = <span class="built_in">CreateWindow</span>(_T(<span class="string">&quot;EorTheDreamOfGameDevelop&quot;</span>), </span><br><span class="line">		WINDOW_TITLE, WS_OVERLAPPEDWINDOW, CW_USEDEFAULT, CW_USEDEFAULT, </span><br><span class="line">		WINDOW_WIDTH, WINDOW_HEIGHT, <span class="literal">NULL</span>, <span class="literal">NULL</span>, hInstance, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">MoveWindow</span>(hwnd, <span class="number">250</span>, <span class="number">80</span>, WINDOW_WIDTH, WINDOW_HEIGHT, <span class="literal">true</span>);</span><br><span class="line">	<span class="built_in">ShowWindow</span>(hwnd, nShowCmd);</span><br><span class="line">	<span class="built_in">UpdateWindow</span>(hwnd);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!<span class="built_in">Game_Init</span>(hwnd))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">MessageBox</span>(hwnd, _T(<span class="string">&quot;资源初始化失败&quot;</span>), _T(<span class="string">&quot;消息窗口&quot;</span>), <span class="number">0</span>);</span><br><span class="line">		<span class="keyword">return</span> FALSE;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	MSG msg = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">	<span class="keyword">while</span>(msg.message != WM_QUIT)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">PeekMessage</span>(&amp;msg, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, PM_REMOVE))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">TranslateMessage</span>(&amp;msg);</span><br><span class="line">			<span class="built_in">DispatchMessage</span>(&amp;msg);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">UnregisterClass</span>(_T(<span class="string">&quot;EorTheDreamOfGameDevelop&quot;</span>), wndClass.hInstance);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">LRESULT <span class="title">WndProc</span><span class="params">(HWND hwnd, UINT message, WPARAM wParam, LPARAM lParam)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	PAINTSTRUCT paintStruct;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">switch</span> (message)</span><br><span class="line">	&#123;</span><br><span class="line">	<span class="keyword">case</span> WM_PAINT:</span><br><span class="line">		g_hdc = <span class="built_in">BeginPaint</span>(hwnd, &amp;paintStruct);</span><br><span class="line">		<span class="built_in">Game_Paint</span>(hwnd);</span><br><span class="line">		<span class="built_in">EndPaint</span>(hwnd, &amp;paintStruct);	</span><br><span class="line">		<span class="built_in">ValidateRect</span>(hwnd, <span class="literal">NULL</span>);</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> WM_KEYDOWN:</span><br><span class="line">		<span class="keyword">if</span> (wParam == VK_ESCAPE)</span><br><span class="line">			<span class="built_in">DestroyWindow</span>(hwnd);</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> WM_DESTROY:</span><br><span class="line">		<span class="built_in">Game_CleanUp</span>(hwnd);</span><br><span class="line">		<span class="built_in">PostQuitMessage</span>(<span class="number">0</span>);</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">DefWindowProc</span>(hwnd, message, wParam, lParam);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">BOOL <span class="title">Game_Init</span><span class="params">(HWND hwnd)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	g_hdc = <span class="built_in">GetDC</span>(hwnd);</span><br><span class="line">	<span class="built_in">Game_Paint</span>(hwnd);</span><br><span class="line">	<span class="built_in">ReleaseDC</span>(hwnd, g_hdc);</span><br><span class="line">	<span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">VOID <span class="title">Game_Paint</span><span class="params">(HWND hwnd)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">BOOL <span class="title">Game_CleanUp</span><span class="params">(HWND hwnd)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="2-GDIdemo1">2.GDIdemo1</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//-----------------------------------【程序说明】----------------------------------------------</span></span><br><span class="line"><span class="comment">//  程序名称:：GDIdemoCore</span></span><br><span class="line"><span class="comment">//	 2013年3月 Create by 浅墨</span></span><br><span class="line"><span class="comment">//  描述：GDI基本几何绘图示例程序</span></span><br><span class="line"><span class="comment">//------------------------------------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//-----------------------------------【头文件包含部分】---------------------------------------</span></span><br><span class="line"><span class="comment">//	描述：包含程序所依赖的头文件</span></span><br><span class="line"><span class="comment">//------------------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span>  <span class="string">&lt;time.h&gt;</span> <span class="comment">//使用获取系统时间time函数需要包含的头文件</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//-----------------------------------【库文件包含部分】---------------------------------------</span></span><br><span class="line"><span class="comment">//	描述：包含程序所依赖的库文件</span></span><br><span class="line"><span class="comment">//------------------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib,<span class="string">&quot;winmm.lib&quot;</span>)  <span class="comment">//调用PlaySound函数所需库文件</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//-----------------------------------【宏定义部分】--------------------------------------------</span></span><br><span class="line"><span class="comment">//	描述：定义一些辅助宏</span></span><br><span class="line"><span class="comment">//------------------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WINDOW_WIDTH	800							<span class="comment">//为窗口宽度定义的宏，以方便在此处修改窗口宽度</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WINDOW_HEIGHT	600							<span class="comment">//为窗口高度定义的宏，以方便在此处修改窗口高度</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WINDOW_TITLE	<span class="string">L&quot;【致我们永不熄灭的游戏开发梦想】GDI基本几何绘图&quot;</span>	<span class="comment">//为窗口标题定义的宏</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//-----------------------------------【全局变量声明部分】-------------------------------------</span></span><br><span class="line"><span class="comment">//	描述：全局变量的声明</span></span><br><span class="line"><span class="comment">//------------------------------------------------------------------------------------------------</span></span><br><span class="line">HDC			g_hdc = <span class="literal">NULL</span>;       <span class="comment">//全局设备环境句柄</span></span><br><span class="line">HPEN		g_hPen[<span class="number">7</span>] = &#123; <span class="number">0</span> &#125;; <span class="comment">//定义画笔句柄的数组</span></span><br><span class="line">HBRUSH	g_hBrush[<span class="number">7</span>] = &#123; <span class="number">0</span> &#125;; <span class="comment">//定义画刷句柄的数组</span></span><br><span class="line"><span class="type">int</span>				g_iPenStyle[<span class="number">7</span>] = &#123; PS_SOLID,PS_DASH,PS_DOT,PS_DASHDOT,PS_DASHDOTDOT,PS_NULL,PS_INSIDEFRAME &#125;;  <span class="comment">//定义画笔样式数组并初始化</span></span><br><span class="line"><span class="type">int</span>				g_iBrushStyle[<span class="number">6</span>] = &#123; HS_VERTICAL,HS_HORIZONTAL,HS_CROSS,HS_DIAGCROSS,HS_FDIAGONAL,HS_BDIAGONAL &#125;;  <span class="comment">//定义画刷样式数组并初始化</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//-----------------------------------【全局函数声明部分】-------------------------------------</span></span><br><span class="line"><span class="comment">//	描述：全局函数声明，防止“未声明的标识”系列错误</span></span><br><span class="line"><span class="comment">//------------------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="function">LRESULT CALLBACK	<span class="title">WndProc</span><span class="params">(HWND hwnd, UINT message, WPARAM wParam, LPARAM lParam)</span></span>;<span class="comment">//窗口过程函数</span></span><br><span class="line"><span class="function">BOOL						<span class="title">Game_Init</span><span class="params">(HWND hwnd)</span></span>;			<span class="comment">//在此函数中进行资源的初始化</span></span><br><span class="line"><span class="function">VOID							<span class="title">Game_Paint</span><span class="params">(HWND hwnd)</span></span>;		<span class="comment">//在此函数中进行绘图代码的书写</span></span><br><span class="line"><span class="function">BOOL						<span class="title">Game_CleanUp</span><span class="params">(HWND hwnd)</span></span>;	<span class="comment">//在此函数中进行资源的清理</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//-----------------------------------【WinMain( )函数】--------------------------------------</span></span><br><span class="line"><span class="comment">//	描述：Windows应用程序的入口函数，我们的程序从这里开始</span></span><br><span class="line"><span class="comment">//------------------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="function"><span class="type">int</span> WINAPI <span class="title">WinMain</span><span class="params">(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpCmdLine, <span class="type">int</span> nShowCmd)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">//【1】窗口创建四步曲之一：开始设计一个完整的窗口类</span></span><br><span class="line">	WNDCLASSEX wndClass = &#123; <span class="number">0</span> &#125;;							<span class="comment">//用WINDCLASSEX定义了一个窗口类</span></span><br><span class="line">	wndClass.cbSize = <span class="built_in">sizeof</span>(WNDCLASSEX);			<span class="comment">//设置结构体的字节数大小</span></span><br><span class="line">	wndClass.style = CS_HREDRAW | CS_VREDRAW;	<span class="comment">//设置窗口的样式</span></span><br><span class="line">	wndClass.lpfnWndProc = WndProc;					<span class="comment">//设置指向窗口过程函数的指针</span></span><br><span class="line">	wndClass.cbClsExtra = <span class="number">0</span>;								<span class="comment">//窗口类的附加内存，取0就可以了</span></span><br><span class="line">	wndClass.cbWndExtra = <span class="number">0</span>;							<span class="comment">//窗口的附加内存，依然取0就行了</span></span><br><span class="line">	wndClass.hInstance = hInstance;						<span class="comment">//指定包含窗口过程的程序的实例句柄。</span></span><br><span class="line">	wndClass.hIcon = (HICON)::<span class="built_in">LoadImage</span>(<span class="literal">NULL</span>, <span class="string">L&quot;icon.ico&quot;</span>, IMAGE_ICON, <span class="number">0</span>, <span class="number">0</span>, LR_DEFAULTSIZE | LR_LOADFROMFILE);  <span class="comment">//本地加载自定义ico图标</span></span><br><span class="line">	wndClass.hCursor = <span class="built_in">LoadCursor</span>(<span class="literal">NULL</span>, IDC_ARROW);    <span class="comment">//指定窗口类的光标句柄。</span></span><br><span class="line">	wndClass.hbrBackground = (HBRUSH)<span class="built_in">GetStockObject</span>(WHITE_BRUSH);  <span class="comment">//为hbrBackground成员指定一个白色画刷句柄	</span></span><br><span class="line">	wndClass.lpszMenuName = <span class="literal">NULL</span>;						<span class="comment">//用一个以空终止的字符串，指定菜单资源的名字。</span></span><br><span class="line">	wndClass.lpszClassName = <span class="string">L&quot;ForTheDreamOfGameDevelop&quot;</span>;		<span class="comment">//用一个以空终止的字符串，指定窗口类的名字。</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//【2】窗口创建四步曲之二：注册窗口类</span></span><br><span class="line">	<span class="keyword">if</span> (!<span class="built_in">RegisterClassEx</span>(&amp;wndClass))				<span class="comment">//设计完窗口后，需要对窗口类进行注册，这样才能创建该类型的窗口</span></span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//【3】窗口创建四步曲之三：正式创建窗口</span></span><br><span class="line">	HWND hwnd = <span class="built_in">CreateWindow</span>(<span class="string">L&quot;ForTheDreamOfGameDevelop&quot;</span>, WINDOW_TITLE,				<span class="comment">//喜闻乐见的创建窗口函数CreateWindow</span></span><br><span class="line">		WS_OVERLAPPEDWINDOW, CW_USEDEFAULT, CW_USEDEFAULT, WINDOW_WIDTH,</span><br><span class="line">		WINDOW_HEIGHT, <span class="literal">NULL</span>, <span class="literal">NULL</span>, hInstance, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//【4】窗口创建四步曲之四：窗口的移动、显示与更新</span></span><br><span class="line">	<span class="built_in">MoveWindow</span>(hwnd, <span class="number">250</span>, <span class="number">80</span>, WINDOW_WIDTH, WINDOW_HEIGHT, <span class="literal">true</span>);		<span class="comment">//调整窗口显示时的位置，使窗口左上角位于（250,80）处</span></span><br><span class="line">	<span class="built_in">ShowWindow</span>(hwnd, nShowCmd);    <span class="comment">//调用ShowWindow函数来显示窗口</span></span><br><span class="line">	<span class="built_in">UpdateWindow</span>(hwnd);						<span class="comment">//对窗口进行更新，就像我们买了新房子要装修一样</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//游戏资源的初始化，若初始化失败，弹出一个消息框，并返回FALSE</span></span><br><span class="line">	<span class="keyword">if</span> (!<span class="built_in">Game_Init</span>(hwnd))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">MessageBox</span>(hwnd, <span class="string">L&quot;资源初始化失败&quot;</span>, <span class="string">L&quot;消息窗口&quot;</span>, <span class="number">0</span>); <span class="comment">//使用MessageBox函数，创建一个消息窗口</span></span><br><span class="line">		<span class="keyword">return</span> FALSE;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">PlaySound</span>(<span class="string">L&quot;AIR - 夏影.wav&quot;</span>, <span class="literal">NULL</span>, SND_FILENAME | SND_ASYNC | SND_LOOP); <span class="comment">//循环播放背景音乐 </span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//【5】消息循环过程</span></span><br><span class="line">	MSG msg = &#123; <span class="number">0</span> &#125;;				<span class="comment">//定义并初始化msg</span></span><br><span class="line">	<span class="keyword">while</span> (msg.message != WM_QUIT)		<span class="comment">//使用while循环，如果消息不是WM_QUIT消息，就继续循环</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">PeekMessage</span>(&amp;msg, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, PM_REMOVE))   <span class="comment">//查看应用程序消息队列，有消息时将队列中的消息派发出去。</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">TranslateMessage</span>(&amp;msg);		<span class="comment">//将虚拟键消息转换为字符消息</span></span><br><span class="line">			<span class="built_in">DispatchMessage</span>(&amp;msg);			<span class="comment">//分发一个消息给窗口程序。</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//【6】窗口类的注销</span></span><br><span class="line">	<span class="built_in">UnregisterClass</span>(<span class="string">L&quot;ForTheDreamOfGameDevelop&quot;</span>, wndClass.hInstance);  <span class="comment">//程序准备结束，注销窗口类</span></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//-----------------------------------【WndProc( )函数】--------------------------------------</span></span><br><span class="line"><span class="comment">//	描述：窗口过程函数WndProc,对窗口消息进行处理</span></span><br><span class="line"><span class="comment">//------------------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="function">LRESULT CALLBACK <span class="title">WndProc</span><span class="params">(HWND hwnd, UINT message, WPARAM wParam, LPARAM lParam)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	PAINTSTRUCT paintStruct;			<span class="comment">//定义一个PAINTSTRUCT结构体来记录一些绘制信息</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">switch</span> (message)						<span class="comment">//switch语句开始</span></span><br><span class="line">	&#123;</span><br><span class="line">	<span class="keyword">case</span> WM_PAINT:						<span class="comment">// 若是客户区重绘消息</span></span><br><span class="line">		g_hdc = <span class="built_in">BeginPaint</span>(hwnd, &amp;paintStruct);  <span class="comment">//指定窗口进行绘图工作的准备，并用将和绘图有关的信息填充到paintStruct结构体中。</span></span><br><span class="line">		<span class="built_in">Game_Paint</span>(hwnd);</span><br><span class="line">		<span class="built_in">EndPaint</span>(hwnd, &amp;paintStruct);			<span class="comment">//EndPaint函数标记指定窗口的绘画过程结束</span></span><br><span class="line">		<span class="built_in">ValidateRect</span>(hwnd, <span class="literal">NULL</span>);		<span class="comment">// 更新客户区的显示</span></span><br><span class="line">		<span class="keyword">break</span>;									<span class="comment">//跳出该switch语句</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">case</span> WM_KEYDOWN:					<span class="comment">// 若是键盘按下消息</span></span><br><span class="line">		<span class="keyword">if</span> (wParam == VK_ESCAPE)    <span class="comment">// 如果被按下的键是ESC</span></span><br><span class="line">			<span class="built_in">DestroyWindow</span>(hwnd);		<span class="comment">// 销毁窗口, 并发送一条WM_DESTROY消息</span></span><br><span class="line">		<span class="keyword">break</span>;									<span class="comment">//跳出该switch语句</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">case</span> WM_DESTROY:					<span class="comment">//若是窗口销毁消息</span></span><br><span class="line">		<span class="built_in">Game_CleanUp</span>(hwnd);			<span class="comment">//调用自定义的资源清理函数Game_CleanUp（）进行退出前的资源清理</span></span><br><span class="line">		<span class="built_in">PostQuitMessage</span>(<span class="number">0</span>);			<span class="comment">//向系统表明有个线程有终止请求。用来响应WM_DESTROY消息</span></span><br><span class="line">		<span class="keyword">break</span>;									<span class="comment">//跳出该switch语句</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">default</span>:										<span class="comment">//若上述case条件都不符合，则执行该default语句</span></span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">DefWindowProc</span>(hwnd, message, wParam, lParam);		<span class="comment">//调用缺省的窗口过程</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;									<span class="comment">//正常退出</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//-----------------------------------【Game_Init( )函数】--------------------------------------</span></span><br><span class="line"><span class="comment">//	描述：初始化函数，进行一些简单的初始化</span></span><br><span class="line"><span class="comment">//------------------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="function">BOOL <span class="title">Game_Init</span><span class="params">(HWND hwnd)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	g_hdc = <span class="built_in">GetDC</span>(hwnd);  <span class="comment">//获取设备环境句柄</span></span><br><span class="line">	<span class="built_in">srand</span>((<span class="type">unsigned</span>)<span class="built_in">time</span>(<span class="literal">NULL</span>));      <span class="comment">//用系统时间初始化随机种子 </span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//随机初始化画笔和画刷的颜色值</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">6</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		g_hPen[i] = <span class="built_in">CreatePen</span>(g_iPenStyle[i], <span class="number">1</span>, <span class="built_in">RGB</span>(<span class="built_in">rand</span>() % <span class="number">256</span>, <span class="built_in">rand</span>() % <span class="number">256</span>, <span class="built_in">rand</span>() % <span class="number">256</span>));</span><br><span class="line">		<span class="keyword">if</span> (i == <span class="number">6</span>)</span><br><span class="line">			g_hBrush[i] = <span class="built_in">CreateSolidBrush</span>(<span class="built_in">RGB</span>(<span class="built_in">rand</span>() % <span class="number">256</span>, <span class="built_in">rand</span>() % <span class="number">256</span>, <span class="built_in">rand</span>() % <span class="number">256</span>));</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			g_hBrush[i] = <span class="built_in">CreateHatchBrush</span>(g_iBrushStyle[i], <span class="built_in">RGB</span>(<span class="built_in">rand</span>() % <span class="number">256</span>, <span class="built_in">rand</span>() % <span class="number">256</span>, <span class="built_in">rand</span>() % <span class="number">256</span>));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">Game_Paint</span>(hwnd);</span><br><span class="line">	<span class="built_in">ReleaseDC</span>(hwnd, g_hdc);</span><br><span class="line">	<span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//-----------------------------------【Game_Paint( )函数】--------------------------------------</span></span><br><span class="line"><span class="comment">//	描述：绘制函数，在此函数中进行绘制操作</span></span><br><span class="line"><span class="comment">//--------------------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="function">VOID <span class="title">Game_Paint</span><span class="params">(HWND hwnd)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">//定义一个y坐标值</span></span><br><span class="line">	<span class="type">int</span> y = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//一个for循环，用7种不同的画笔绘制线条</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">6</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		y = (i + <span class="number">1</span>) * <span class="number">70</span>;</span><br><span class="line"></span><br><span class="line">		<span class="built_in">SelectObject</span>(g_hdc, g_hPen[i]);<span class="comment">//将对应的画笔选好</span></span><br><span class="line">		<span class="built_in">MoveToEx</span>(g_hdc, <span class="number">30</span>, y, <span class="literal">NULL</span>);	 <span class="comment">//“光标”移动到对应的（30，y）坐标处</span></span><br><span class="line">		<span class="built_in">LineTo</span>(g_hdc, <span class="number">100</span>, y);			 <span class="comment">//从（30，y）坐标处向（100，y）绘制线段</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*注意上面画完后y=420，下面画矩形的时候还有用*/</span></span><br><span class="line">	<span class="comment">//定义两个x坐标值</span></span><br><span class="line">	<span class="type">int</span> x1 = <span class="number">120</span>;</span><br><span class="line">	<span class="type">int</span> x2 = <span class="number">190</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//用7种不同的画刷填充矩形</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">6</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">SelectObject</span>(g_hdc, g_hBrush[i]);  <span class="comment">//选用画刷</span></span><br><span class="line">		<span class="built_in">Rectangle</span>(g_hdc, x1, <span class="number">70</span>, x2, y);	 <span class="comment">//画出一个封闭的矩形，矩形左上角坐标为（x1,50），右下角坐标为（x2，y）</span></span><br><span class="line">		x1 += <span class="number">90</span>;</span><br><span class="line">		x2 += <span class="number">90</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//-----------------------------------【Game_CleanUp( )函数】--------------------------------</span></span><br><span class="line"><span class="comment">//	描述：资源清理函数，在此函数中进行程序退出前资源的清理工作</span></span><br><span class="line"><span class="comment">//---------------------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="function">BOOL <span class="title">Game_CleanUp</span><span class="params">(HWND hwnd)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">//一个for循环，释放掉所有的画笔和画刷句柄</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">6</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">DeleteObject</span>(g_hPen[i]);</span><br><span class="line">		<span class="built_in">DeleteObject</span>(g_hBrush[i]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      

    </section>
    
      <section class='ArticleMeta'>
          <div>
            发布于&nbsp;
            <time datetime="2023-03-12T16:00:00.000Z" itemprop="datePublished">
              2023-03-13
            </time>
          </div>
          
      </section>
    
    
      <section>
        <div id="disqus_thread"></div>
        <script>
          window.disqus_config = function () {
            this.page.url = window.location.toString()
            this.page.identifier = window.location.pathname
          }
          if (typeof DISQUS === 'undefined') {
            (function() { // DON'T EDIT BELOW THIS LINE
              var d = document, s = d.createElement('script');
              s.src = 'https://YunyinBlog.disqus.com/embed.js';
              s.setAttribute('data-timestamp', +new Date());
              (d.head || d.body).appendChild(s);
            })();
          } else {
            DISQUS.reset({
                reload: true,
                config: window.disqus_config
            })
          }
        </script>
      </section>
    
</article>

  
</div>

            <footer>
    <div>© 2024 - Yunyin </div>
    <div>
        <span>
            Powered by <a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a>
        </span>
        ,
        <span>
            Theme - <a target="_blank" rel="noopener" href="https://github.com/nameoverflow/hexo-theme-icalm">Icalm</a>
        </span>
    </div>
</footer>

        </div>
    </div>
</div>

<script src="/js/pager/dist/singlepager.js"></script>

<script>
var sp = new Pager('data-pager-shell')

</script>
</body>
</html>